<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<div id="visualisation" class="show_products">


</div>


<script>

    var productRequest = new XMLHttpRequest();
    productRequest.open("get", "handle_requests.php?target=product&action=getAllProducts");
    productRequest.onreadystatechange = function (ev) {
        if (this.readyState == 4 && this.status == 200) {
            var response = this.responseText;
            var products = JSON.parse(response);
            console.log(products);
            for (var i = 0; i < products.length; i++) {

                var product = products[i];
                var visualisation = document.getElementById("visualisation");
                var showProduct = document.createElement('div');
                showProduct.className = "shown_products";
                visualisation.appendChild(showProduct);
                var productName = document.createElement("div");
                productName.className = "product_name";
                var productImg = document.createElement("div");
                productImg.className = "product_img";
                var showProductInfoLink = document.createElement("a");
                showProductInfoLink.id = "show_product";
                var img = document.createElement("img");
                showProductInfoLink.appendChild(img);
                productImg.appendChild(showProductInfoLink);
                var productPrice = document.createElement("div");
                productPrice.className = "price";
                var productSizes = document.createElement("div");
                productSizes.classList = "product-type";
                var spanPrice = document.createElement("span");
                spanPrice.className = "price";
                var spanPriceOnSale = document.createElement("span");
                spanPriceOnSale.className = "line-trough";
                productPrice.appendChild(spanPrice);
                productPrice.appendChild(spanPriceOnSale);
                var divButtons = document.createElement("div");
                divButtons.className = "div-buttons";

                showProduct.appendChild(productName);
                showProduct.appendChild(productImg);
                showProduct.appendChild(productPrice);
                showProduct.appendChild(divButtons);
                showProduct.appendChild(productSizes);


                productName.innerHTML = product.product_name;
                img.src = product.product_image_url;
                showProductInfoLink.href = "index.php?page=product_info&id=" + product.product_id;

                var selectSize = document.createElement("select");
                selectSize.className = "sizes";
                selectSize.style = "display: inline-block";
                productSizes.appendChild(selectSize);
                var sizes = product.sizes;
                for (var j = 0; j < sizes.length; j++ ){
                        var size = sizes[j];
                    selectSize.options[selectSize.options.length] = new Option(size.size, size.size);

                }


                if(product.promo_percentage > 0){

                    var newPrice = product.price  - (product.price * product.promo_percentage)/100;
                    spanPriceOnSale.innerHTML =  product.price;
                    spanPrice.innerHTML =  " Now: " + newPrice + " BGN Was: ";

                }
                else{
                    spanPrice.innerHTML = " Price: " +product.price + " BGN ";
                }

                var addToCartButton = document.createElement("button");
                divButtons.appendChild(addToCartButton);
                addToCartButton.className= "buttons";
                addToCartButton.innerHTML = "Add to cart";
                addToCartButton.onclick = addToCart(product.product_id);

                var addToFavButton = document.createElement("button");
                divButtons.appendChild(addToFavButton);
                addToFavButton.className= "buttons";
                addToFavButton.innerHTML = "Add to favorites";
                addToFavButton.onclick = addToFav(product.product_id);

            }






        }
    }
    productRequest.send();


    function addToCart(product_id){
    }
    function addToFav(product_id){
    }
</script>

</body>
</html>